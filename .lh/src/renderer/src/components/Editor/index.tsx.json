{
    "sourceFile": "src/renderer/src/components/Editor/index.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 47,
            "patches": [
                {
                    "date": 1665496693570,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1665496704134,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -17,9 +17,8 @@\n interface MilkdownEditor {\n   onHeadersChange: Function\n }\n export const MilkdownEditor: React.FC<MilkdownEditor> = ({ onHeadersChange }) => {\n-  const [headers, setHeaders] = useState([{}])\n   useEffect(() => {\n     console.log('headers-change')\n     onHeadersChange(headers)\n   }, [headers.length])\n"
                },
                {
                    "date": 1665496710646,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -17,12 +17,8 @@\n interface MilkdownEditor {\n   onHeadersChange: Function\n }\n export const MilkdownEditor: React.FC<MilkdownEditor> = ({ onHeadersChange }) => {\n-  useEffect(() => {\n-    console.log('headers-change')\n-    onHeadersChange(headers)\n-  }, [headers.length])\n   const { editor, getInstance } = useEditor((root) =>\n     Editor.make()\n       .config((ctx) => {\n         ctx.set(rootCtx, root),\n"
                },
                {
                    "date": 1665497543528,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,9 +4,9 @@\n import { ReactEditor, useEditor } from '@milkdown/react'\n // 通用markdown预设\n import { commonmark } from '@milkdown/preset-commonmark'\n import { history } from '@milkdown/plugin-history'\n-import { defaultMarkdown } from '../../constant'\n+\n import { listenerCtx, listener } from '@milkdown/plugin-listener'\n import { prism } from '@milkdown/plugin-prism'\n import { menu } from '@milkdown/plugin-menu'\n import { themeManagerCtx } from '@milkdown/core'\n"
                },
                {
                    "date": 1665497548834,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -21,9 +21,13 @@\n   const { editor, getInstance } = useEditor((root) =>\n     Editor.make()\n       .config((ctx) => {\n         ctx.set(rootCtx, root),\n-          ctx.set(defaultValueCtx, defaultMarkdown),\n+          ctx.set(defaultValueCtx, `# H1\n+          ## H2\n+          ### H3\n+          #### H4\n+          ###### H5`),\n           // // 代码的默认形式？\n           // ctx.set(defaultValueCtx,{\n           //     type:'html',\n           //     dom:document.querySelector('#pre') as HTMLElement\n"
                },
                {
                    "date": 1665500699045,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -13,21 +13,30 @@\n // 亮色主题\n import { nordLight } from '@milkdown/theme-nord'\n // 暗色主题\n import { nordDark } from '@milkdown/theme-nord'\n+// 官方引用的图标库，如菜单栏需要使用到\n+import '@material-design-icons/font'\n+// 数学公式渲染\n+import 'katex/dist/katex.min.css'\n+// 代码高亮\n+import 'prism-themes/themes/prism-material-oceanic.min.css'\n interface MilkdownEditor {\n   onHeadersChange: Function\n }\n export const MilkdownEditor: React.FC<MilkdownEditor> = ({ onHeadersChange }) => {\n   const { editor, getInstance } = useEditor((root) =>\n     Editor.make()\n       .config((ctx) => {\n         ctx.set(rootCtx, root),\n-          ctx.set(defaultValueCtx, `# H1\n+          ctx.set(\n+            defaultValueCtx,\n+            `# H1\n           ## H2\n           ### H3\n           #### H4\n-          ###### H5`),\n+          ###### H5`\n+          ),\n           // // 代码的默认形式？\n           // ctx.set(defaultValueCtx,{\n           //     type:'html',\n           //     dom:document.querySelector('#pre') as HTMLElement\n"
                },
                {
                    "date": 1665500707677,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,9 +22,9 @@\n import 'prism-themes/themes/prism-material-oceanic.min.css'\n interface MilkdownEditor {\n   onHeadersChange: Function\n }\n-export const MilkdownEditor: React.FC<MilkdownEditor> = ({ onHeadersChange }) => {\n+export const MilkdownEditor: React.FC<MilkdownEditor> = () => {\n   const { editor, getInstance } = useEditor((root) =>\n     Editor.make()\n       .config((ctx) => {\n         ctx.set(rootCtx, root),\n"
                },
                {
                    "date": 1665500716444,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -20,9 +20,8 @@\n import 'katex/dist/katex.min.css'\n // 代码高亮\n import 'prism-themes/themes/prism-material-oceanic.min.css'\n interface MilkdownEditor {\n-  onHeadersChange: Function\n }\n export const MilkdownEditor: React.FC<MilkdownEditor> = () => {\n   const { editor, getInstance } = useEditor((root) =>\n     Editor.make()\n"
                },
                {
                    "date": 1665503483477,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,23 +19,20 @@\n // 数学公式渲染\n import 'katex/dist/katex.min.css'\n // 代码高亮\n import 'prism-themes/themes/prism-material-oceanic.min.css'\n-interface MilkdownEditor {\n-}\n+interface MilkdownEditor {}\n+const DEFAULT_MARKDOWN = `# H1\n+## H2\n+### H3\n+#### H4\n+###### H5`\n export const MilkdownEditor: React.FC<MilkdownEditor> = () => {\n   const { editor, getInstance } = useEditor((root) =>\n     Editor.make()\n       .config((ctx) => {\n         ctx.set(rootCtx, root),\n-          ctx.set(\n-            defaultValueCtx,\n-            `# H1\n-          ## H2\n-          ### H3\n-          #### H4\n-          ###### H5`\n-          ),\n+          ctx.set(defaultValueCtx, DEFAULT_MARKDOWN),\n           // // 代码的默认形式？\n           // ctx.set(defaultValueCtx,{\n           //     type:'html',\n           //     dom:document.querySelector('#pre') as HTMLElement\n"
                },
                {
                    "date": 1665555339805,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -45,11 +45,16 @@\n       .use(listener)\n       .use(prism)\n       .use(menu)\n   )\n-\n   const instance = getInstance()\n   instance?.action((ctx) => {\n     ctx.get(themeManagerCtx).switch(ctx, nordDark)\n   })\n+  useEffect(() => {\n+    const handleRightClick = () => {}\n+    const editor = document.querySelector('.editor')\n+    editor?.addEventListener('contextmenu', handleRightClick)\n+    return editor?.removeEventListener('contextmenu', handleRightClick)\n+  })\n   return <ReactEditor editor={editor} />\n }\n"
                },
                {
                    "date": 1665555348436,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -50,9 +50,11 @@\n   instance?.action((ctx) => {\n     ctx.get(themeManagerCtx).switch(ctx, nordDark)\n   })\n   useEffect(() => {\n-    const handleRightClick = () => {}\n+    const handleRightClick = () => {\n+      console.log('right-click')\n+    }\n     const editor = document.querySelector('.editor')\n     editor?.addEventListener('contextmenu', handleRightClick)\n     return editor?.removeEventListener('contextmenu', handleRightClick)\n   })\n"
                },
                {
                    "date": 1665589054134,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,8 +25,9 @@\n ## H2\n ### H3\n #### H4\n ###### H5`\n+window.api.onUpdateEditor\n export const MilkdownEditor: React.FC<MilkdownEditor> = () => {\n   const { editor, getInstance } = useEditor((root) =>\n     Editor.make()\n       .config((ctx) => {\n"
                },
                {
                    "date": 1665590638679,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,9 +25,11 @@\n ## H2\n ### H3\n #### H4\n ###### H5`\n-window.api.onUpdateEditor\n+window.api.onUpdateEditor((e: any,value: any)=>{\n+  console.log(value)\n+})\n export const MilkdownEditor: React.FC<MilkdownEditor> = () => {\n   const { editor, getInstance } = useEditor((root) =>\n     Editor.make()\n       .config((ctx) => {\n"
                },
                {
                    "date": 1665591176549,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,9 +25,10 @@\n ## H2\n ### H3\n #### H4\n ###### H5`\n-window.api.onUpdateEditor((e: any,value: any)=>{\n+window.api.onUpdateEditor((e,value)=>{\n+  console.log(e)\n   console.log(value)\n })\n export const MilkdownEditor: React.FC<MilkdownEditor> = () => {\n   const { editor, getInstance } = useEditor((root) =>\n"
                },
                {
                    "date": 1665632240457,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,6 +1,6 @@\n import React, { useEffect, useState } from 'react'\n-import { defaultValueCtx, Editor, rootCtx } from '@milkdown/core'\n+import { defaultValueCtx, Editor, editorViewCtx, rootCtx, serializerCtx } from '@milkdown/core'\n import { nord } from '@milkdown/theme-nord'\n import { ReactEditor, useEditor } from '@milkdown/react'\n // 通用markdown预设\n import { commonmark } from '@milkdown/preset-commonmark'\n@@ -29,20 +29,17 @@\n window.api.onUpdateEditor((e,value)=>{\n   console.log(e)\n   console.log(value)\n })\n+\n+\n export const MilkdownEditor: React.FC<MilkdownEditor> = () => {\n   const { editor, getInstance } = useEditor((root) =>\n     Editor.make()\n       .config((ctx) => {\n         ctx.set(rootCtx, root),\n           ctx.set(defaultValueCtx, DEFAULT_MARKDOWN),\n-          // // 代码的默认形式？\n-          // ctx.set(defaultValueCtx,{\n-          //     type:'html',\n-          //     dom:document.querySelector('#pre') as HTMLElement\n-          //   })\n-          ctx.get(listenerCtx).markdownUpdated((ctx, markdown, prevMarkdown) => {})\n+\n       })\n       .use(nord)\n       .use(commonmark)\n       .use(history)\n@@ -53,8 +50,12 @@\n   const instance = getInstance()\n   instance?.action((ctx) => {\n     ctx.get(themeManagerCtx).switch(ctx, nordDark)\n   })\n+  instance?.config(ctx =>{\n+    ctx.get(listenerCtx).markdownUpdated((ctx, markdown, prevMarkdown) => {})\n+\n+  })\n   useEffect(() => {\n     const handleRightClick = () => {\n       console.log('right-click')\n     }\n"
                },
                {
                    "date": 1665632248101,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -51,9 +51,11 @@\n   instance?.action((ctx) => {\n     ctx.get(themeManagerCtx).switch(ctx, nordDark)\n   })\n   instance?.config(ctx =>{\n-    ctx.get(listenerCtx).markdownUpdated((ctx, markdown, prevMarkdown) => {})\n+    ctx.get(listenerCtx).markdownUpdated((ctx, markdown, prevMarkdown) => {\n+      console.log(markdown)\n+    })\n \n   })\n   useEffect(() => {\n     const handleRightClick = () => {\n"
                },
                {
                    "date": 1665632267993,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -36,9 +36,9 @@\n   const { editor, getInstance } = useEditor((root) =>\n     Editor.make()\n       .config((ctx) => {\n         ctx.set(rootCtx, root),\n-          ctx.set(defaultValueCtx, DEFAULT_MARKDOWN),\n+          ctx.set(defaultValueCtx, DEFAULT_MARKDOWN)\n \n       })\n       .use(nord)\n       .use(commonmark)\n"
                },
                {
                    "date": 1665632312182,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -37,9 +37,11 @@\n     Editor.make()\n       .config((ctx) => {\n         ctx.set(rootCtx, root),\n           ctx.set(defaultValueCtx, DEFAULT_MARKDOWN)\n-\n+          ctx.get(listenerCtx).markdownUpdated((ctx, markdown, prevMarkdown) => {\n+            console.log(markdown)\n+          })\n       })\n       .use(nord)\n       .use(commonmark)\n       .use(history)\n"
                },
                {
                    "date": 1665632376682,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -35,13 +35,13 @@\n export const MilkdownEditor: React.FC<MilkdownEditor> = () => {\n   const { editor, getInstance } = useEditor((root) =>\n     Editor.make()\n       .config((ctx) => {\n-        ctx.set(rootCtx, root),\n+          ctx.set(rootCtx, root),\n           ctx.set(defaultValueCtx, DEFAULT_MARKDOWN)\n-          ctx.get(listenerCtx).markdownUpdated((ctx, markdown, prevMarkdown) => {\n-            console.log(markdown)\n-          })\n+          // ctx.get(listenerCtx).markdownUpdated((ctx, markdown, prevMarkdown) => {\n+          //   console.log(markdown)\n+          // })\n       })\n       .use(nord)\n       .use(commonmark)\n       .use(history)\n@@ -52,9 +52,9 @@\n   const instance = getInstance()\n   instance?.action((ctx) => {\n     ctx.get(themeManagerCtx).switch(ctx, nordDark)\n   })\n-  instance?.config(ctx =>{\n+   instance?.config(ctx =>{\n     ctx.get(listenerCtx).markdownUpdated((ctx, markdown, prevMarkdown) => {\n       console.log(markdown)\n     })\n \n"
                },
                {
                    "date": 1665632588624,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,9 +4,9 @@\n import { ReactEditor, useEditor } from '@milkdown/react'\n // 通用markdown预设\n import { commonmark } from '@milkdown/preset-commonmark'\n import { history } from '@milkdown/plugin-history'\n-\n+import {useConfig} from './hooks/useConfig' \n import { listenerCtx, listener } from '@milkdown/plugin-listener'\n import { prism } from '@milkdown/plugin-prism'\n import { menu } from '@milkdown/plugin-menu'\n import { themeManagerCtx } from '@milkdown/core'\n@@ -37,11 +37,9 @@\n     Editor.make()\n       .config((ctx) => {\n           ctx.set(rootCtx, root),\n           ctx.set(defaultValueCtx, DEFAULT_MARKDOWN)\n-          // ctx.get(listenerCtx).markdownUpdated((ctx, markdown, prevMarkdown) => {\n-          //   console.log(markdown)\n-          // })\n+          useConfig(ctx)\n       })\n       .use(nord)\n       .use(commonmark)\n       .use(history)\n@@ -52,14 +50,8 @@\n   const instance = getInstance()\n   instance?.action((ctx) => {\n     ctx.get(themeManagerCtx).switch(ctx, nordDark)\n   })\n-   instance?.config(ctx =>{\n-    ctx.get(listenerCtx).markdownUpdated((ctx, markdown, prevMarkdown) => {\n-      console.log(markdown)\n-    })\n-\n-  })\n   useEffect(() => {\n     const handleRightClick = () => {\n       console.log('right-click')\n     }\n"
                },
                {
                    "date": 1665632837995,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,13 +1,13 @@\n-import React, { useEffect, useState } from 'react'\n-import { defaultValueCtx, Editor, editorViewCtx, rootCtx, serializerCtx } from '@milkdown/core'\n+import React, { useEffect } from 'react'\n+import { Editor, rootCtx } from '@milkdown/core'\n import { nord } from '@milkdown/theme-nord'\n import { ReactEditor, useEditor } from '@milkdown/react'\n // 通用markdown预设\n import { commonmark } from '@milkdown/preset-commonmark'\n import { history } from '@milkdown/plugin-history'\n import {useConfig} from './hooks/useConfig' \n-import { listenerCtx, listener } from '@milkdown/plugin-listener'\n+import { listener } from '@milkdown/plugin-listener'\n import { prism } from '@milkdown/plugin-prism'\n import { menu } from '@milkdown/plugin-menu'\n import { themeManagerCtx } from '@milkdown/core'\n // 亮色主题\n@@ -20,13 +20,9 @@\n import 'katex/dist/katex.min.css'\n // 代码高亮\n import 'prism-themes/themes/prism-material-oceanic.min.css'\n interface MilkdownEditor {}\n-const DEFAULT_MARKDOWN = `# H1\n-## H2\n-### H3\n-#### H4\n-###### H5`\n+\n window.api.onUpdateEditor((e,value)=>{\n   console.log(e)\n   console.log(value)\n })\n@@ -36,9 +32,8 @@\n   const { editor, getInstance } = useEditor((root) =>\n     Editor.make()\n       .config((ctx) => {\n           ctx.set(rootCtx, root),\n-          ctx.set(defaultValueCtx, DEFAULT_MARKDOWN)\n           useConfig(ctx)\n       })\n       .use(nord)\n       .use(commonmark)\n@@ -50,13 +45,14 @@\n   const instance = getInstance()\n   instance?.action((ctx) => {\n     ctx.get(themeManagerCtx).switch(ctx, nordDark)\n   })\n+  // 右键菜单\n   useEffect(() => {\n     const handleRightClick = () => {\n       console.log('right-click')\n     }\n-    const editor = document.querySelector('.editor')\n+    const editor = document.querySelector('.milkdown')\n     editor?.addEventListener('contextmenu', handleRightClick)\n     return editor?.removeEventListener('contextmenu', handleRightClick)\n   })\n   return <ReactEditor editor={editor} />\n"
                },
                {
                    "date": 1665633714401,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,6 +1,6 @@\n import React, { useEffect } from 'react'\n-import { Editor, rootCtx } from '@milkdown/core'\n+import { defaultValueCtx, Editor, rootCtx } from '@milkdown/core'\n import { nord } from '@milkdown/theme-nord'\n import { ReactEditor, useEditor } from '@milkdown/react'\n // 通用markdown预设\n import { commonmark } from '@milkdown/preset-commonmark'\n@@ -19,22 +19,25 @@\n // 数学公式渲染\n import 'katex/dist/katex.min.css'\n // 代码高亮\n import 'prism-themes/themes/prism-material-oceanic.min.css'\n-interface MilkdownEditor {}\n+interface MilkdownEditor {\n+  markdown:string\n+}\n \n window.api.onUpdateEditor((e,value)=>{\n   console.log(e)\n   console.log(value)\n })\n \n \n-export const MilkdownEditor: React.FC<MilkdownEditor> = () => {\n+export const MilkdownEditor: React.FC<MilkdownEditor> = ({markdown}) => {\n   const { editor, getInstance } = useEditor((root) =>\n     Editor.make()\n       .config((ctx) => {\n           ctx.set(rootCtx, root),\n-          useConfig(ctx)\n+          ctx.set(defaultValueCtx, markdown)\n+          // useConfig(ctx)\n       })\n       .use(nord)\n       .use(commonmark)\n       .use(history)\n"
                },
                {
                    "date": 1665633847510,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -34,9 +34,9 @@\n   const { editor, getInstance } = useEditor((root) =>\n     Editor.make()\n       .config((ctx) => {\n           ctx.set(rootCtx, root),\n-          ctx.set(defaultValueCtx, markdown)\n+          ctx.set(defaultValueCtx, '')\n           // useConfig(ctx)\n       })\n       .use(nord)\n       .use(commonmark)\n"
                },
                {
                    "date": 1665633864984,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -34,9 +34,9 @@\n   const { editor, getInstance } = useEditor((root) =>\n     Editor.make()\n       .config((ctx) => {\n           ctx.set(rootCtx, root),\n-          ctx.set(defaultValueCtx, '')\n+          ctx.set(defaultValueCtx, markdown)\n           // useConfig(ctx)\n       })\n       .use(nord)\n       .use(commonmark)\n"
                },
                {
                    "date": 1665634017801,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -30,8 +30,9 @@\n })\n \n \n export const MilkdownEditor: React.FC<MilkdownEditor> = ({markdown}) => {\n+  console.log(markdown)\n   const { editor, getInstance } = useEditor((root) =>\n     Editor.make()\n       .config((ctx) => {\n           ctx.set(rootCtx, root),\n"
                },
                {
                    "date": 1665635050058,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,8 @@\n-import React, { useEffect } from 'react'\n-import { defaultValueCtx, Editor, rootCtx } from '@milkdown/core'\n+import React, { useEffect, useRef, useState } from 'react'\n+import { Ctx, defaultValueCtx, Editor, editorViewCtx, parserCtx, rootCtx } from '@milkdown/core'\n import { nord } from '@milkdown/theme-nord'\n-import { ReactEditor, useEditor } from '@milkdown/react'\n+import { EditorRef, ReactEditor, useEditor } from '@milkdown/react'\n // 通用markdown预设\n import { commonmark } from '@milkdown/preset-commonmark'\n import { history } from '@milkdown/plugin-history'\n import {useConfig} from './hooks/useConfig' \n@@ -19,45 +19,50 @@\n // 数学公式渲染\n import 'katex/dist/katex.min.css'\n // 代码高亮\n import 'prism-themes/themes/prism-material-oceanic.min.css'\n-interface MilkdownEditor {\n-  markdown:string\n-}\n+import { Slice } from \"prosemirror-model\";\n \n-window.api.onUpdateEditor((e,value)=>{\n-  console.log(e)\n-  console.log(value)\n-})\n+const MilkdownEditor: React.FC = () => {\n+  const editorRef = useRef<EditorRef | null>(null);\n+  const [isContentLoaded, setContentLoaded] = useState<boolean>(false);\n \n+const {editor}= useEditor(\n+      (root) => {\n+        return new Editor()\n+            .config((ctx) => {\n+                ctx.set(rootCtx, root);\n+                ctx.set(defaultValueCtx, \"Default value\");\n+            })\n+            .use(commonmark)\n+            .use(listener)\n+            .use(history);\n+      },\n+      [],\n+  );\n \n-export const MilkdownEditor: React.FC<MilkdownEditor> = ({markdown}) => {\n-  console.log(markdown)\n-  const { editor, getInstance } = useEditor((root) =>\n-    Editor.make()\n-      .config((ctx) => {\n-          ctx.set(rootCtx, root),\n-          ctx.set(defaultValueCtx, markdown)\n-          // useConfig(ctx)\n-      })\n-      .use(nord)\n-      .use(commonmark)\n-      .use(history)\n-      .use(listener)\n-      .use(prism)\n-      .use(menu)\n-  )\n-  const instance = getInstance()\n-  instance?.action((ctx) => {\n-    ctx.get(themeManagerCtx).switch(ctx, nordDark)\n-  })\n-  // 右键菜单\n-  useEffect(() => {\n-    const handleRightClick = () => {\n-      console.log('right-click')\n+useEffect(() => {\n+   if (editorRef.current) {\n+      const editor = editorRef.current.get();\n+      if (editor) {\n+        editor.action((ctx: Ctx) => {\n+          const view = ctx.get(editorViewCtx);\n+          const parser = ctx.get(parserCtx);\n+          const doc = parser('Content changed !!!');\n+          if (!doc) return;\n+          const state = view.state;\n+          view.dispatch(\n+            state.tr.replace(\n+              0,\n+              state.doc.content.size,\n+              new Slice(doc.content, 0, 0)\n+            )\n+          );\n+        });\n+      }\n     }\n-    const editor = document.querySelector('.milkdown')\n-    editor?.addEventListener('contextmenu', handleRightClick)\n-    return editor?.removeEventListener('contextmenu', handleRightClick)\n-  })\n-  return <ReactEditor editor={editor} />\n-}\n+},[isContentLoaded])\n+\n+  return <ReactEditor ref={editorRef} editor={editor} />;\n+};\n+\n+export default MilkdownEditor;\n\\ No newline at end of file\n"
                },
                {
                    "date": 1665635085574,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -21,9 +21,9 @@\n // 代码高亮\n import 'prism-themes/themes/prism-material-oceanic.min.css'\n import { Slice } from \"prosemirror-model\";\n \n-const MilkdownEditor: React.FC = () => {\n+export const MilkdownEditor: React.FC = () => {\n   const editorRef = useRef<EditorRef | null>(null);\n   const [isContentLoaded, setContentLoaded] = useState<boolean>(false);\n \n const {editor}= useEditor(\n@@ -63,6 +63,4 @@\n },[isContentLoaded])\n \n   return <ReactEditor ref={editorRef} editor={editor} />;\n };\n-\n-export default MilkdownEditor;\n\\ No newline at end of file\n"
                },
                {
                    "date": 1665635099541,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -21,9 +21,9 @@\n // 代码高亮\n import 'prism-themes/themes/prism-material-oceanic.min.css'\n import { Slice } from \"prosemirror-model\";\n \n-export const MilkdownEditor: React.FC = () => {\n+export const MilkEditor: React.FC = () => {\n   const editorRef = useRef<EditorRef | null>(null);\n   const [isContentLoaded, setContentLoaded] = useState<boolean>(false);\n \n const {editor}= useEditor(\n"
                },
                {
                    "date": 1665635129595,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -21,9 +21,9 @@\n // 代码高亮\n import 'prism-themes/themes/prism-material-oceanic.min.css'\n import { Slice } from \"prosemirror-model\";\n \n-export const MilkEditor: React.FC = () => {\n+export const MilkdownEditor: React.FC = () => {\n   const editorRef = useRef<EditorRef | null>(null);\n   const [isContentLoaded, setContentLoaded] = useState<boolean>(false);\n \n const {editor}= useEditor(\n"
                },
                {
                    "date": 1665635273367,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -38,29 +38,29 @@\n             .use(history);\n       },\n       [],\n   );\n-\n-useEffect(() => {\n-   if (editorRef.current) {\n-      const editor = editorRef.current.get();\n-      if (editor) {\n-        editor.action((ctx: Ctx) => {\n-          const view = ctx.get(editorViewCtx);\n-          const parser = ctx.get(parserCtx);\n-          const doc = parser('Content changed !!!');\n-          if (!doc) return;\n-          const state = view.state;\n-          view.dispatch(\n-            state.tr.replace(\n-              0,\n-              state.doc.content.size,\n-              new Slice(doc.content, 0, 0)\n-            )\n-          );\n-        });\n-      }\n+setTimeout(()=>{\n+  if (editorRef.current) {\n+    const editor = editorRef.current.get();\n+    if (editor) {\n+      editor.action((ctx: Ctx) => {\n+        const view = ctx.get(editorViewCtx);\n+        const parser = ctx.get(parserCtx);\n+        const doc = parser('Content changed !!!');\n+        if (!doc) return;\n+        const state = view.state;\n+        view.dispatch(\n+          state.tr.replace(\n+            0,\n+            state.doc.content.size,\n+            new Slice(doc.content, 0, 0)\n+          )\n+        );\n+      });\n     }\n-},[isContentLoaded])\n+  }\n+  console.log('chamge')\n+},3000)\n \n   return <ReactEditor ref={editorRef} editor={editor} />;\n };\n"
                },
                {
                    "date": 1665635288242,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -45,9 +45,9 @@\n     if (editor) {\n       editor.action((ctx: Ctx) => {\n         const view = ctx.get(editorViewCtx);\n         const parser = ctx.get(parserCtx);\n-        const doc = parser('Content changed !!!');\n+        const doc = parser('## Content changed !!!');\n         if (!doc) return;\n         const state = view.state;\n         view.dispatch(\n           state.tr.replace(\n"
                },
                {
                    "date": 1665636113634,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -20,47 +20,67 @@\n import 'katex/dist/katex.min.css'\n // 代码高亮\n import 'prism-themes/themes/prism-material-oceanic.min.css'\n import { Slice } from \"prosemirror-model\";\n+import React, { useEffect } from 'react'\n+import { defaultValueCtx, Editor, rootCtx } from '@milkdown/core'\n+import { nord } from '@milkdown/theme-nord'\n+import { ReactEditor, useEditor } from '@milkdown/react'\n+// 通用markdown预设\n+import { commonmark } from '@milkdown/preset-commonmark'\n+import { history } from '@milkdown/plugin-history'\n+import {useConfig} from './hooks/useConfig' \n+import { listener } from '@milkdown/plugin-listener'\n+import { prism } from '@milkdown/plugin-prism'\n+import { menu } from '@milkdown/plugin-menu'\n+import { themeManagerCtx } from '@milkdown/core'\n+// 亮色主题\n+import { nordLight } from '@milkdown/theme-nord'\n+// 暗色主题\n+import { nordDark } from '@milkdown/theme-nord'\n+// 官方引用的图标库，如菜单栏需要使用到\n+import '@material-design-icons/font'\n+// 数学公式渲染\n+import 'katex/dist/katex.min.css'\n+// 代码高亮\n+import 'prism-themes/themes/prism-material-oceanic.min.css'\n+interface MilkdownEditor {\n+  markdown:string\n+}\n \n-export const MilkdownEditor: React.FC = () => {\n-  const editorRef = useRef<EditorRef | null>(null);\n-  const [isContentLoaded, setContentLoaded] = useState<boolean>(false);\n+window.api.onUpdateEditor((e,value)=>{\n+  console.log(e)\n+  console.log(value)\n+})\n \n-const {editor}= useEditor(\n-      (root) => {\n-        return new Editor()\n-            .config((ctx) => {\n-                ctx.set(rootCtx, root);\n-                ctx.set(defaultValueCtx, \"Default value\");\n-            })\n-            .use(commonmark)\n-            .use(listener)\n-            .use(history);\n-      },\n-      [],\n-  );\n-setTimeout(()=>{\n-  if (editorRef.current) {\n-    const editor = editorRef.current.get();\n-    if (editor) {\n-      editor.action((ctx: Ctx) => {\n-        const view = ctx.get(editorViewCtx);\n-        const parser = ctx.get(parserCtx);\n-        const doc = parser('## Content changed !!!');\n-        if (!doc) return;\n-        const state = view.state;\n-        view.dispatch(\n-          state.tr.replace(\n-            0,\n-            state.doc.content.size,\n-            new Slice(doc.content, 0, 0)\n-          )\n-        );\n-      });\n+\n+export const MilkdownEditor: React.FC<MilkdownEditor> = ({markdown}) => {\n+  console.log(markdown)\n+  const { editor, getInstance } = useEditor((root) =>\n+    Editor.make()\n+      .config((ctx) => {\n+          ctx.set(rootCtx, root),\n+          ctx.set(defaultValueCtx, markdown)\n+          // useConfig(ctx)\n+      })\n+      .use(nord)\n+      .use(commonmark)\n+      .use(history)\n+      .use(listener)\n+      .use(prism)\n+      .use(menu)\n+  )\n+  const instance = getInstance()\n+  instance?.action((ctx) => {\n+    ctx.get(themeManagerCtx).switch(ctx, nordDark)\n+  })\n+  // 右键菜单\n+  useEffect(() => {\n+    const handleRightClick = () => {\n+      console.log('right-click')\n     }\n-  }\n-  console.log('chamge')\n-},3000)\n-\n-  return <ReactEditor ref={editorRef} editor={editor} />;\n-};\n+    const editor = document.querySelector('.milkdown')\n+    editor?.addEventListener('contextmenu', handleRightClick)\n+    return editor?.removeEventListener('contextmenu', handleRightClick)\n+  })\n+  return <ReactEditor editor={editor} />\n+}\n\\ No newline at end of file\n"
                },
                {
                    "date": 1665636331998,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,9 +4,9 @@\n import { EditorRef, ReactEditor, useEditor } from '@milkdown/react'\n // 通用markdown预设\n import { commonmark } from '@milkdown/preset-commonmark'\n import { history } from '@milkdown/plugin-history'\n-import {useConfig} from './hooks/useConfig' \n+import { useConfig } from './hooks/useConfig'\n import { listener } from '@milkdown/plugin-listener'\n import { prism } from '@milkdown/plugin-prism'\n import { menu } from '@milkdown/plugin-menu'\n import { themeManagerCtx } from '@milkdown/core'\n@@ -19,17 +19,17 @@\n // 数学公式渲染\n import 'katex/dist/katex.min.css'\n // 代码高亮\n import 'prism-themes/themes/prism-material-oceanic.min.css'\n-import { Slice } from \"prosemirror-model\";\n+import { Slice } from 'prosemirror-model'\n import React, { useEffect } from 'react'\n import { defaultValueCtx, Editor, rootCtx } from '@milkdown/core'\n import { nord } from '@milkdown/theme-nord'\n import { ReactEditor, useEditor } from '@milkdown/react'\n // 通用markdown预设\n import { commonmark } from '@milkdown/preset-commonmark'\n import { history } from '@milkdown/plugin-history'\n-import {useConfig} from './hooks/useConfig' \n+import { useConfig } from './hooks/useConfig'\n import { listener } from '@milkdown/plugin-listener'\n import { prism } from '@milkdown/plugin-prism'\n import { menu } from '@milkdown/plugin-menu'\n import { themeManagerCtx } from '@milkdown/core'\n@@ -43,25 +43,23 @@\n import 'katex/dist/katex.min.css'\n // 代码高亮\n import 'prism-themes/themes/prism-material-oceanic.min.css'\n interface MilkdownEditor {\n-  markdown:string\n+  markdown: string\n }\n \n-window.api.onUpdateEditor((e,value)=>{\n+window.api.onUpdateEditor((e, value) => {\n   console.log(e)\n   console.log(value)\n })\n \n-\n-export const MilkdownEditor: React.FC<MilkdownEditor> = ({markdown}) => {\n-  console.log(markdown)\n+export const MilkdownEditor: React.FC<MilkdownEditor> = ({ markdown }) => {\n+  const [content, setContent] = useState('')\n   const { editor, getInstance } = useEditor((root) =>\n     Editor.make()\n       .config((ctx) => {\n-          ctx.set(rootCtx, root),\n-          ctx.set(defaultValueCtx, markdown)\n-          // useConfig(ctx)\n+        ctx.set(rootCtx, root), ctx.set(defaultValueCtx, markdown)\n+        // useConfig(ctx)\n       })\n       .use(nord)\n       .use(commonmark)\n       .use(history)\n@@ -81,6 +79,16 @@\n     const editor = document.querySelector('.milkdown')\n     editor?.addEventListener('contextmenu', handleRightClick)\n     return editor?.removeEventListener('contextmenu', handleRightClick)\n   })\n+  useEffect(() => {\n+    instance?.action((ctx) => {\n\\ No newline at end of file\n+      const view = ctx.get(editorViewCtx)\n+      const parser = ctx.get(parserCtx)\n+      const doc = parser(content)\n+      if (!doc) return\n+      const state = view.state\n+      view.dispatch(state.tr.replace(0, state.doc.content.size, new Slice(doc.content, 0, 0)))\n+    })\n+  }, [content])\n   return <ReactEditor editor={editor} />\n-}\n+}\n"
                },
                {
                    "date": 1665636348482,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -42,18 +42,15 @@\n // 数学公式渲染\n import 'katex/dist/katex.min.css'\n // 代码高亮\n import 'prism-themes/themes/prism-material-oceanic.min.css'\n-interface MilkdownEditor {\n-  markdown: string\n-}\n \n window.api.onUpdateEditor((e, value) => {\n   console.log(e)\n   console.log(value)\n })\n \n-export const MilkdownEditor: React.FC<MilkdownEditor> = ({ markdown }) => {\n+export const MilkdownEditor: React.FC<MilkdownEditor> = () => {\n   const [content, setContent] = useState('')\n   const { editor, getInstance } = useEditor((root) =>\n     Editor.make()\n       .config((ctx) => {\n@@ -90,5 +87,5 @@\n       view.dispatch(state.tr.replace(0, state.doc.content.size, new Slice(doc.content, 0, 0)))\n     })\n   }, [content])\n   return <ReactEditor editor={editor} />\n-}\n\\ No newline at end of file\n+}\n"
                },
                {
                    "date": 1665636359652,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -42,8 +42,10 @@\n // 数学公式渲染\n import 'katex/dist/katex.min.css'\n // 代码高亮\n import 'prism-themes/themes/prism-material-oceanic.min.css'\n+interface MilkdownEditor {\n+}\n \n window.api.onUpdateEditor((e, value) => {\n   console.log(e)\n   console.log(value)\n"
                },
                {
                    "date": 1665636373245,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -42,10 +42,9 @@\n // 数学公式渲染\n import 'katex/dist/katex.min.css'\n // 代码高亮\n import 'prism-themes/themes/prism-material-oceanic.min.css'\n-interface MilkdownEditor {\n-}\n+interface MilkdownEditor {}\n \n window.api.onUpdateEditor((e, value) => {\n   console.log(e)\n   console.log(value)\n@@ -55,9 +54,9 @@\n   const [content, setContent] = useState('')\n   const { editor, getInstance } = useEditor((root) =>\n     Editor.make()\n       .config((ctx) => {\n-        ctx.set(rootCtx, root), ctx.set(defaultValueCtx, markdown)\n+        ctx.set(rootCtx, root), ctx.set(defaultValueCtx, content)\n         // useConfig(ctx)\n       })\n       .use(nord)\n       .use(commonmark)\n"
                },
                {
                    "date": 1665636394537,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -87,6 +87,9 @@\n       const state = view.state\n       view.dispatch(state.tr.replace(0, state.doc.content.size, new Slice(doc.content, 0, 0)))\n     })\n   }, [content])\n+  setTimeout(()=>{\n+setContent('# hello')\n+  },2000)\n   return <ReactEditor editor={editor} />\n }\n"
                },
                {
                    "date": 1665636439299,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,30 +19,9 @@\n // 数学公式渲染\n import 'katex/dist/katex.min.css'\n // 代码高亮\n import 'prism-themes/themes/prism-material-oceanic.min.css'\n-import { Slice } from 'prosemirror-model'\n-import React, { useEffect } from 'react'\n-import { defaultValueCtx, Editor, rootCtx } from '@milkdown/core'\n-import { nord } from '@milkdown/theme-nord'\n-import { ReactEditor, useEditor } from '@milkdown/react'\n-// 通用markdown预设\n-import { commonmark } from '@milkdown/preset-commonmark'\n-import { history } from '@milkdown/plugin-history'\n-import { useConfig } from './hooks/useConfig'\n-import { listener } from '@milkdown/plugin-listener'\n-import { prism } from '@milkdown/plugin-prism'\n-import { menu } from '@milkdown/plugin-menu'\n-import { themeManagerCtx } from '@milkdown/core'\n-// 亮色主题\n-import { nordLight } from '@milkdown/theme-nord'\n-// 暗色主题\n-import { nordDark } from '@milkdown/theme-nord'\n-// 官方引用的图标库，如菜单栏需要使用到\n-import '@material-design-icons/font'\n-// 数学公式渲染\n-import 'katex/dist/katex.min.css'\n-// 代码高亮\n+\n import 'prism-themes/themes/prism-material-oceanic.min.css'\n interface MilkdownEditor {}\n \n window.api.onUpdateEditor((e, value) => {\n"
                },
                {
                    "date": 1665636470460,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,10 +19,9 @@\n // 数学公式渲染\n import 'katex/dist/katex.min.css'\n // 代码高亮\n import 'prism-themes/themes/prism-material-oceanic.min.css'\n-\n-import 'prism-themes/themes/prism-material-oceanic.min.css'\n+import { Slice } from \"prosemirror-model\";\n interface MilkdownEditor {}\n \n window.api.onUpdateEditor((e, value) => {\n   console.log(e)\n"
                },
                {
                    "date": 1665636482196,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,9 +19,9 @@\n // 数学公式渲染\n import 'katex/dist/katex.min.css'\n // 代码高亮\n import 'prism-themes/themes/prism-material-oceanic.min.css'\n-import { Slice } from \"prosemirror-model\";\n+import { Slice } from 'prosemirror-model'\n interface MilkdownEditor {}\n \n window.api.onUpdateEditor((e, value) => {\n   console.log(e)\n@@ -65,9 +65,9 @@\n       const state = view.state\n       view.dispatch(state.tr.replace(0, state.doc.content.size, new Slice(doc.content, 0, 0)))\n     })\n   }, [content])\n-  setTimeout(()=>{\n-setContent('# hello')\n-  },2000)\n+  setTimeout(() => {\n+    setContent('# hello')\n+  }, 2000)\n   return <ReactEditor editor={editor} />\n }\n"
                },
                {
                    "date": 1665636497537,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -33,9 +33,9 @@\n   const { editor, getInstance } = useEditor((root) =>\n     Editor.make()\n       .config((ctx) => {\n         ctx.set(rootCtx, root), ctx.set(defaultValueCtx, content)\n-        // useConfig(ctx)\n+        useConfig(ctx)\n       })\n       .use(nord)\n       .use(commonmark)\n       .use(history)\n"
                },
                {
                    "date": 1665636514070,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -65,9 +65,6 @@\n       const state = view.state\n       view.dispatch(state.tr.replace(0, state.doc.content.size, new Slice(doc.content, 0, 0)))\n     })\n   }, [content])\n-  setTimeout(() => {\n-    setContent('# hello')\n-  }, 2000)\n   return <ReactEditor editor={editor} />\n }\n"
                },
                {
                    "date": 1665637200874,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,13 +22,10 @@\n import 'prism-themes/themes/prism-material-oceanic.min.css'\n import { Slice } from 'prosemirror-model'\n interface MilkdownEditor {}\n \n-window.api.onUpdateEditor((e, value) => {\n-  console.log(e)\n-  console.log(value)\n-})\n \n+\n export const MilkdownEditor: React.FC<MilkdownEditor> = () => {\n   const [content, setContent] = useState('')\n   const { editor, getInstance } = useEditor((root) =>\n     Editor.make()\n@@ -55,8 +52,14 @@\n     const editor = document.querySelector('.milkdown')\n     editor?.addEventListener('contextmenu', handleRightClick)\n     return editor?.removeEventListener('contextmenu', handleRightClick)\n   })\n+  useEffect(()=>{\n+    console.log('listene')\n+    window.api.onUpdateEditor((e, value) => {\n+\n+    })\n+  },[])\n   useEffect(() => {\n     instance?.action((ctx) => {\n       const view = ctx.get(editorViewCtx)\n       const parser = ctx.get(parserCtx)\n"
                },
                {
                    "date": 1665637206306,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -55,9 +55,9 @@\n   })\n   useEffect(()=>{\n     console.log('listene')\n     window.api.onUpdateEditor((e, value) => {\n-\n+      console.log(value)\n     })\n   },[])\n   useEffect(() => {\n     instance?.action((ctx) => {\n"
                },
                {
                    "date": 1665637436049,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -57,9 +57,10 @@\n     console.log('listene')\n     window.api.onUpdateEditor((e, value) => {\n       console.log(value)\n     })\n-  },[])\n+    return window.api.onUpdateEditor = null\n+  })\n   useEffect(() => {\n     instance?.action((ctx) => {\n       const view = ctx.get(editorViewCtx)\n       const parser = ctx.get(parserCtx)\n"
                },
                {
                    "date": 1665637473424,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -57,10 +57,10 @@\n     console.log('listene')\n     window.api.onUpdateEditor((e, value) => {\n       console.log(value)\n     })\n-    return window.api.onUpdateEditor = null\n   })\n+  console.log(window.ap)\n   useEffect(() => {\n     instance?.action((ctx) => {\n       const view = ctx.get(editorViewCtx)\n       const parser = ctx.get(parserCtx)\n"
                },
                {
                    "date": 1665637527729,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -53,14 +53,13 @@\n     editor?.addEventListener('contextmenu', handleRightClick)\n     return editor?.removeEventListener('contextmenu', handleRightClick)\n   })\n   useEffect(()=>{\n-    console.log('listene')\n     window.api.onUpdateEditor((e, value) => {\n-      console.log(value)\n+      setContent(value)\n     })\n-  })\n-  console.log(window.ap)\n+  },[])\n+  console.log(window.api)\n   useEffect(() => {\n     instance?.action((ctx) => {\n       const view = ctx.get(editorViewCtx)\n       const parser = ctx.get(parserCtx)\n"
                },
                {
                    "date": 1665642819390,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -58,8 +58,9 @@\n       setContent(value)\n     })\n   },[])\n   console.log(window.api)\n+  // 更新内容\n   useEffect(() => {\n     instance?.action((ctx) => {\n       const view = ctx.get(editorViewCtx)\n       const parser = ctx.get(parserCtx)\n"
                }
            ],
            "date": 1665496693570,
            "name": "Commit-0",
            "content": "import React, { useEffect, useState } from 'react'\nimport { defaultValueCtx, Editor, rootCtx } from '@milkdown/core'\nimport { nord } from '@milkdown/theme-nord'\nimport { ReactEditor, useEditor } from '@milkdown/react'\n// 通用markdown预设\nimport { commonmark } from '@milkdown/preset-commonmark'\nimport { history } from '@milkdown/plugin-history'\nimport { defaultMarkdown } from '../../constant'\nimport { listenerCtx, listener } from '@milkdown/plugin-listener'\nimport { prism } from '@milkdown/plugin-prism'\nimport { menu } from '@milkdown/plugin-menu'\nimport { themeManagerCtx } from '@milkdown/core'\n// 亮色主题\nimport { nordLight } from '@milkdown/theme-nord'\n// 暗色主题\nimport { nordDark } from '@milkdown/theme-nord'\ninterface MilkdownEditor {\n  onHeadersChange: Function\n}\nexport const MilkdownEditor: React.FC<MilkdownEditor> = ({ onHeadersChange }) => {\n  const [headers, setHeaders] = useState([{}])\n  useEffect(() => {\n    console.log('headers-change')\n    onHeadersChange(headers)\n  }, [headers.length])\n  const { editor, getInstance } = useEditor((root) =>\n    Editor.make()\n      .config((ctx) => {\n        ctx.set(rootCtx, root),\n          ctx.set(defaultValueCtx, defaultMarkdown),\n          // // 代码的默认形式？\n          // ctx.set(defaultValueCtx,{\n          //     type:'html',\n          //     dom:document.querySelector('#pre') as HTMLElement\n          //   })\n          ctx.get(listenerCtx).markdownUpdated((ctx, markdown, prevMarkdown) => {})\n      })\n      .use(nord)\n      .use(commonmark)\n      .use(history)\n      .use(listener)\n      .use(prism)\n      .use(menu)\n  )\n\n  const instance = getInstance()\n  instance?.action((ctx) => {\n    ctx.get(themeManagerCtx).switch(ctx, nordDark)\n  })\n  return <ReactEditor editor={editor} />\n}\n"
        }
    ]
}